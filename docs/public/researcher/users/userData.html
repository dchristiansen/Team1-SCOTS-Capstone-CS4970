<!DOCTYPE html>

<html>
<head>
  <title>userData.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="..\..\..\docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>userData.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { getAllSessionsForUser } <span class="hljs-keyword">from</span> <span class="hljs-string">"../..//Data.js"</span>;
<span class="hljs-keyword">import</span> { getUser } <span class="hljs-keyword">from</span> <span class="hljs-string">"../..//Data.js"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>From to recover a userâ€™s password</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> accountRecoveryForm = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">".admin-recovery"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Form to delete a user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> deleteUserForm = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">".admin-delete-user"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Get table from the html document</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> table = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">"#tablebody"</span>);
<span class="hljs-keyword">let</span> currentAssignmentArray = [];
<span class="hljs-keyword">let</span> checkedArray;
<span class="hljs-keyword">let</span> numPages;
<span class="hljs-keyword">let</span> currentPage = <span class="hljs-number">1</span>;
<span class="hljs-keyword">let</span> entriesPerPage = <span class="hljs-number">5</span>;

<span class="hljs-comment">/*
    setHeader
    parameter: userid
    Set the header with the passed in assignmentId
*/</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setHeader</span>(<span class="hljs-params">userid</span>) </span>{
    <span class="hljs-keyword">let</span> header = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">"#useridheader"</span>);
    <span class="hljs-keyword">let</span> usercall = <span class="hljs-keyword">await</span> getUser(userid);
    <span class="hljs-keyword">let</span> username = usercall.data.userID;
    header.innerHTML = <span class="hljs-string">"User ID: "</span> + username;
}

<span class="hljs-comment">/*
    populateTable
    Parameter: userid
    Populates the sessions for a given userid
*/</span>
<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">populateTable</span>(<span class="hljs-params">newPage</span>) </span>{
    table.innerHTML = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">let</span> startPosition = (newPage - <span class="hljs-number">1</span>) * entriesPerPage;
    <span class="hljs-keyword">let</span> newArray = currentAssignmentArray.slice(startPosition, startPosition + <span class="hljs-number">5</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Loop through sessionData</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; newArray.length; i++){
        <span class="hljs-keyword">let</span> obj = newArray[i];</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Create a row entry for each session</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> tr = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'tr'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Create a column for the session id and append the it to the row</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> td_id = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'td'</span>);
        <span class="hljs-keyword">let</span> sessionID = obj.data.assignmentID
        td_id.innerHTML = sessionID;
        tr.appendChild(td_id);</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Create a column for the latest session time and append it to the row</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> td_time = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'td'</span>);
        <span class="hljs-keyword">let</span> sessionTime = obj.data.sessionTime;
        sessionTime = sessionTime.seconds * <span class="hljs-number">1000</span>;
        sessionTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(sessionTime);
        td_time.innerHTML = sessionTime.toLocaleString(navigator.language);
        tr.appendChild(td_time);</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Create a column for the parameters</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> td_params = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'td'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Grab the parameters from obj.data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> parameters = obj.data.parameters;
        <span class="hljs-keyword">let</span> fbt = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">if</span> (parameters.feedback == <span class="hljs-string">"true"</span>) {

            fbt = <span class="hljs-string">"On"</span>
        } <span class="hljs-keyword">else</span> {
            fbt = <span class="hljs-string">"Off"</span>
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Fill in the text with parameter and append the column to the row</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        td_params.innerHTML = parameters.bpm + <span class="hljs-string">" BPM, "</span> + parameters.soundOnTime + <span class="hljs-string">" On, "</span> + parameters.soundOffTime + <span class="hljs-string">" Off, "</span> + parameters.cycles + <span class="hljs-string">" Cycles, Feedback "</span> + fbt;
        tr.appendChild(td_params);</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Create checkbox</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> td_checkbox = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'td'</span>);
        <span class="hljs-keyword">let</span> label = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'label'</span>);
        <span class="hljs-keyword">let</span> checkbox = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'input'</span>);
        <span class="hljs-keyword">let</span> span = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'span'</span>);
        checkbox.type = <span class="hljs-string">"checkbox"</span>;
        checkbox.addEventListener(<span class="hljs-string">'input'</span>, checkCheckedArray);
        <span class="hljs-keyword">if</span>(checkedArray[i + (currentPage - <span class="hljs-number">1</span>) * entriesPerPage]) {
            checkbox.checked = <span class="hljs-literal">true</span>;
        }
        label.appendChild(checkbox);
        label.appendChild(span);
        td_checkbox.appendChild(label);
        tr.appendChild(td_checkbox);
        table.appendChild(tr);</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Remove the disabled property for the select all button once table is populated</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> selectBtn = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">"#select"</span>);
        selectBtn.classList.remove(<span class="hljs-string">"disabled"</span>);
    }
    createPagination();
}

<span class="hljs-comment">/*
  createPagination:
  Creates the pagination icons beneath the table,
  based on the number of pages
*/</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createPagination</span>(<span class="hljs-params"></span>) </span>{
    pagination.innerHTML = <span class="hljs-string">""</span>;
    numPages = <span class="hljs-built_in">Math</span>.ceil(currentAssignmentArray.length / entriesPerPage);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Create the left chevron for page scrolling</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> leftChevron = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'li'</span>);
    leftChevron.className = <span class="hljs-string">"waves-effect"</span>;

    <span class="hljs-keyword">let</span> leftChevronA = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'a'</span>);
    leftChevronA.href = <span class="hljs-string">"#!"</span>;
    leftChevronA.setAttribute(<span class="hljs-string">'data-page'</span>, <span class="hljs-string">"prev"</span>);

    <span class="hljs-keyword">let</span> leftChevronIcon = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'i'</span>);
    leftChevronIcon.className = <span class="hljs-string">"material-icons"</span>;
    leftChevronIcon.innerHTML = <span class="hljs-string">"chevron_left"</span>;

    leftChevronA.appendChild(leftChevronIcon);
    leftChevron.appendChild(leftChevronA);
    pagination.appendChild(leftChevron);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Create the buttons for each page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; numPages; i++) {
        <span class="hljs-keyword">let</span> current = i + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">let</span> li = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'li'</span>);
        li.id = <span class="hljs-string">"page"</span> + current;
        li.className = <span class="hljs-string">"waves-effect"</span>;
        <span class="hljs-keyword">if</span> (current == currentPage) {
            li.className += <span class="hljs-string">" active"</span>;
        }

        <span class="hljs-keyword">let</span> a = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'a'</span>);
        a.setAttribute(<span class="hljs-string">'data-page'</span>, current)
        a.innerHTML = current;

        li.appendChild(a);
        pagination.appendChild(li);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Add the right chevron for page scrolling</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> rightChevron = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'li'</span>);
    rightChevron.className = <span class="hljs-string">"waves-effect"</span>;

    <span class="hljs-keyword">let</span> rightChevronA = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'a'</span>);
    rightChevronA.href = <span class="hljs-string">"#!"</span>;
    rightChevronA.setAttribute(<span class="hljs-string">'data-page'</span>, <span class="hljs-string">"next"</span>)

    <span class="hljs-keyword">let</span> rightChevronIcon = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'i'</span>);
    rightChevronIcon.className = <span class="hljs-string">"material-icons"</span>;
    rightChevronIcon.innerHTML = <span class="hljs-string">"chevron_right"</span>;

    rightChevronA.appendChild(rightChevronIcon);
    rightChevron.appendChild(rightChevronA);
    pagination.appendChild(rightChevron);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkCheckedArray</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">let</span> index = e.path[<span class="hljs-number">3</span>].rowIndex - <span class="hljs-number">1</span>;
    index += (currentPage - <span class="hljs-number">1</span>) * entriesPerPage;
    checkedArray[index] = !checkedArray[index];
}

<span class="hljs-comment">/*
    download:
    onclick function of the download button that gets
    the selected sessions of a user and downloads them
*/</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">download</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">let</span> checkboxes = $(<span class="hljs-string">"#tablebody input:checked"</span>);
    <span class="hljs-keyword">if</span> (checkboxes.length == <span class="hljs-number">0</span>) {
        alert(<span class="hljs-string">"Please select at least one session to download"</span>)
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">let</span> sessionsDL = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Get new zip object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> zip = <span class="hljs-keyword">new</span> JSZip();
        checkboxes = $(<span class="hljs-string">"#tablebody input"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Iterate through sessionData</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; checkedArray.length; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>If a session is checked, push that session into the array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (checkedArray[i]) {
                sessionsDL.push({ <span class="hljs-attr">session</span>: sessionData[i].data, <span class="hljs-attr">id</span>: i });
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>If there is only one session to be downloaded</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (sessionsDL.length == <span class="hljs-number">1</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Grab that session</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">let</span> session = sessionsDL[<span class="hljs-number">0</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Format the data</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">let</span> data = formatCSV(session.session);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Create an Excel Workbook</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">let</span> wb = XLSX.utils.book_new()</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Write the data to an Excel worksheet</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">let</span> ws = XLSX.utils.json_to_sheet(data);</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Add the worksheet to the workbook</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            XLSX.utils.book_append_sheet(wb, ws, <span class="hljs-string">"session"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Download the workbook</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            XLSX.writeFile(wb, <span class="hljs-string">'session'</span> + session.id + <span class="hljs-string">'.xlsx'</span>);
            <span class="hljs-keyword">return</span>;
        } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Iterate through each session</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            sessionsDL.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">session</span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Format the workbook</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">let</span> data = formatCSV(session.session);
                <span class="hljs-keyword">let</span> wb = XLSX.utils.book_new()
                <span class="hljs-keyword">let</span> ws = XLSX.utils.json_to_sheet(data);
                XLSX.utils.book_append_sheet(wb, ws, <span class="hljs-string">"session"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Write workbook data to a binary string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">let</span> wbout = XLSX.write(wb, { <span class="hljs-attr">bookType</span>: <span class="hljs-string">'xlsx'</span>, <span class="hljs-attr">bookSST</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'binary'</span> });</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Add binary of workbook to zip file</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                zip.file(<span class="hljs-string">"session"</span> + session.id + <span class="hljs-string">".xlsx"</span>, wbout, { <span class="hljs-attr">binary</span>: <span class="hljs-literal">true</span> });
            });</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Download Zip File</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            zip.generateAsync({ <span class="hljs-attr">type</span>: <span class="hljs-string">"blob"</span> }).then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">blob</span>) </span>{
                <span class="hljs-built_in">window</span>.saveAs(blob, <span class="hljs-string">"sessions.zip"</span>);
            }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
                jQuery(<span class="hljs-string">"#blob"</span>).text(err);
            });
        }
    }
}

<span class="hljs-comment">/*
    formatCsv:
    Parameter: session
    Properly formats the csv file using the template
    from Dr. Marmelat
*/</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatCSV</span>(<span class="hljs-params">session</span>) </span>{
    <span class="hljs-keyword">let</span> parameters = session.parameters;
    <span class="hljs-keyword">let</span> taps = session.taps;
    <span class="hljs-keyword">let</span> score = session.score
    <span class="hljs-keyword">let</span> data = [];
    data.push([<span class="hljs-string">"Tempo (BPM)"</span>, parameters.bpm]);
    data.push([<span class="hljs-string">"Time On (ms)"</span>, parameters.soundOnTime]);
    data.push([<span class="hljs-string">"Time Off (ms)"</span>, parameters.soundOffTime]);
    data.push([<span class="hljs-string">"Cycles"</span>, parameters.cycles]);
    data.push([<span class="hljs-string">"Feedback"</span>, parameters.feedback]);
    data.push([]);
    data.push([<span class="hljs-string">"Score"</span>, score]);
    data.push([]);
    data.push([<span class="hljs-string">"Cycle Number"</span>, <span class="hljs-string">"Sound On"</span>, <span class="hljs-string">"Beat time (ms)"</span>, <span class="hljs-string">"Tap time (ms)"</span>, <span class="hljs-string">"Release time (ms)"</span>, <span class="hljs-string">"Tap intervals (ms)"</span>, <span class="hljs-string">"Asynchrony (ms)"</span>, <span class="hljs-string">"Key-press duration (ms)"</span>]);
    taps.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">tap</span>) </span>{
        <span class="hljs-keyword">let</span> splitString = tap.split(<span class="hljs-string">","</span>);
        data.push([splitString[<span class="hljs-number">0</span>], splitString[<span class="hljs-number">1</span>], splitString[<span class="hljs-number">2</span>], splitString[<span class="hljs-number">3</span>], splitString[<span class="hljs-number">4</span>], splitString[<span class="hljs-number">5</span>], splitString[<span class="hljs-number">6</span>], splitString[<span class="hljs-number">7</span>]]);
    });
    <span class="hljs-keyword">return</span> data;
}

<span class="hljs-keyword">let</span> sessionData;

<span class="hljs-comment">/*
  onAuthStateChanged(user)
  Observer for Authentication State:
  If the user is logged in and the user is an admin, then this listener will
  populate the sessions table. Otherwise, go back to the user dashboard
  or back to the login screen if not authenticated
*/</span>
firebase.auth().onAuthStateChanged(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>If user is logged in</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (user) {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Get admin token result</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        user.getIdTokenResult().then(<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">idTokenResult</span>) </span>{
            user.admin = idTokenResult.claims.admin;</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>If user is an admin</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (user.admin) {</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Set the onclick method of the download button</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">let</span> downloadButton = <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">"#downloadbutton"</span>);
                downloadButton.onclick = download;</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Grab the userid from the url</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">let</span> params = <span class="hljs-keyword">new</span> URLSearchParams(location.search);
                <span class="hljs-keyword">let</span> userid = params.get(<span class="hljs-string">'id'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Get sessions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">let</span> sessionsCall = <span class="hljs-keyword">await</span> getAllSessionsForUser(userid);
                currentAssignmentArray = sessionData = sessionsCall.dataArray;

                checkedArray = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(sessionData.length);</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Set the header with userid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                setHeader(userid);</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Populate table with sessions from the given userid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                populateTable(<span class="hljs-number">1</span>);
            }
            <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Alert that you are not an admin and return to the user dashboard</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                alert(<span class="hljs-string">"You are not an admin."</span>);
                <span class="hljs-built_in">window</span>.location = <span class="hljs-string">"/user/userdashboard.html"</span>;
            }
        });
    }
    <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Not signed in so redirect to login screen</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"You are not signed in."</span>);
        <span class="hljs-built_in">window</span>.location = <span class="hljs-string">"/login.html"</span>;
    }
});</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Function to select/deselct all checkboxes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>$(<span class="hljs-built_in">document</span>).ready(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    $(<span class="hljs-string">"#select"</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">let</span> checked = !$(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'checked'</span>);
        $(<span class="hljs-string">'input:checkbox'</span>).prop(<span class="hljs-string">'checked'</span>, checked);
        $(<span class="hljs-keyword">this</span>).val(checked ? <span class="hljs-string">'uncheck all'</span> : <span class="hljs-string">'check all'</span>)
        $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'checked'</span>, checked);
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; checkedArray.length; i++) {
            checkedArray[i] = checked;
        }
    });
});

<span class="hljs-comment">/*
    accountRecoveryForm:
    Listener for the account recovery form that calls on a
    Firebase Cloud Function to change a user's password
*/</span>
accountRecoveryForm.addEventListener(<span class="hljs-string">'submit'</span>, (e) =&gt; {
    e.preventDefault();

    <span class="hljs-keyword">if</span> (confirm(<span class="hljs-string">"Are you sure you want to change this user's password?"</span>)) {
        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"spinner"</span>).style.visibility = <span class="hljs-string">"visible"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Grab confirmed password</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> confirmPassword = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"confirmPassword"</span>).value;</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Grab userid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> params = <span class="hljs-keyword">new</span> URLSearchParams(location.search);
        <span class="hljs-keyword">let</span> userid = params.get(<span class="hljs-string">'id'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Grab changeUserPassword function from Firebase</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> changeUserPassword = firebase.functions().httpsCallable(<span class="hljs-string">'changeUserPassword'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Change user password, passing in the user id and the confirmed password to the cloud function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        changeUserPassword({ <span class="hljs-attr">uid</span>: userid, <span class="hljs-attr">password</span>: confirmPassword }).then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
            <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"spinner"</span>).style.visibility = <span class="hljs-string">"hidden"</span>;
            alert(result.data.message)
        }).catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>{
            alert(error.message);
        })
    }
});

<span class="hljs-comment">/*
    deleteUserForm:
    Listener for the delete user form that calls on a
    Firebase Cloud Function to delete a user from Firebase Auth and Firestore
*/</span>
deleteUserForm.addEventListener(<span class="hljs-string">'submit'</span>, (e) =&gt; {
    e.preventDefault();</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Prompt the user of they are sure if they want to delete the user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (confirm(<span class="hljs-string">"Are you sure you want to delete this user?"</span>)) {
        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"spinner"</span>).style.visibility = <span class="hljs-string">"visible"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Grab userid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> params = <span class="hljs-keyword">new</span> URLSearchParams(location.search);
        <span class="hljs-keyword">let</span> userid = params.get(<span class="hljs-string">'id'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Get deleteUser function from Firebase</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> deleteUser = firebase.functions().httpsCallable(<span class="hljs-string">'deleteUser'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Call deleteUser passing in the userid of the user to be deleted</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        deleteUser({ <span class="hljs-attr">uid</span>: userid }).then(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> {
            <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"spinner"</span>).style.visibility = <span class="hljs-string">"hidden"</span>;
            alert(result.data.message);
            <span class="hljs-built_in">window</span>.location = <span class="hljs-string">"/researcher/rPortal.html"</span>;
        }).catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) </span>{
            alert(error.message);
        })
    }
});

$(<span class="hljs-string">"#pagination"</span>).on(<span class="hljs-string">"click"</span>, <span class="hljs-string">"a"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">changePage</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">let</span> newPage = $(<span class="hljs-keyword">this</span>).data(<span class="hljs-string">'page'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Change to the new page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(newPage != currentPage) {</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>For the right chevron</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span>(newPage == <span class="hljs-string">"next"</span>) {
            newPage = currentPage+<span class="hljs-number">1</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>For the left chevron </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(newPage == <span class="hljs-string">"prev"</span>) {
            newPage = currentPage<span class="hljs-number">-1</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Ensure that the new page can be accessed (in case left or right chevrons move it past the number of pages)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span>(newPage &lt;= numPages &amp;&amp; newPage &gt; <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Change the current page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            currentPage = newPage;

            populateTable(newPage);</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Change the active page in the pagination menu</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">"#page"</span> + currentPage).className = <span class="hljs-string">"waves-effect"</span>;
            <span class="hljs-built_in">document</span>.querySelector(<span class="hljs-string">"#page"</span> + newPage).className = <span class="hljs-string">"waves-effect active"</span>;
            }
    }
  });</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
